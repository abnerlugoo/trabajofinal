# ğŸ“Œ Instalar librerÃ­as necesarias (si no estÃ¡n instaladas)
!pip install pandas nltk openpyxl

# ğŸ“Œ Importar librerÃ­as
import pandas as pd
import nltk
from nltk.tokenize import word_tokenize
from google.colab import files

# ğŸ“Œ Descargar el tokenizer de nltk
nltk.download("punkt")

# ğŸ“Œ Subir archivo manualmente desde Google Colab
print("ğŸ“‚ Sube tu archivo Excel con respuestas:")
uploaded = files.upload()

# ğŸ“Œ Obtener el nombre del archivo subido
file_name = list(uploaded.keys())[0]

# ğŸ“Œ Definir las categorÃ­as y palabras clave
categorias = {
    "01_Contratos": ["contratos", "contrataciÃ³n", "convenios", "contratados", "contrataciones", "modificatorios", "monto erogado", "pago por prestaciÃ³n"],
    "02_Proyectos": ["proyectos", "procesos", "medidas de seguridad", "organigrama", "vÃ­ctimas", "consejo directivo", "director general", "observaciones"],
    "03_Valuaciones": ["valuaciones", "viabilidad actuarial", "pago de pensiones", "estudio actuarial", "estudios actuariales", "focus group", "estudios", "investigaciones"],
    "04_Farmacia": ["farmacia", "farmacias", "medicinas", "medicina", "venta de medicinas", "vacuna", "franquiciatarios", "sector salud", "ISAPEG", "farmacÃ©utica", "fÃ¡rmacos"],
    "05_Viajes": ["viajes", "comisiones", "gastos de representaciÃ³n", "viÃ¡ticos", "vuelos", "pasajes", "aÃ©reos", "hospedaje", "viaticos", "hoteles", "casetas", "consumo", "consumos"],
    "06_Legal": ["fundamento", "legal", "igualdad", "ley", "artÃ­culos", "decretos", "legislativos", "documentaciÃ³n", "acuerdos", "normatividad", "aclaraciÃ³n", "aclaraciones"],
    "07_Inmuebles": ["estacionamiento", "estacionamientos", "inmueble", "inmuebles", "donaciÃ³n", "arrendamiento", "arrendamientos", "arrendados", "arrendatario", "plaza", "comercio", "comercial"],
    "08_Personal": ["miembros", "labora", "puesto", "tabular", "cargo", "funcionario", "salario", "laborar", "servidores", "servidor", "pÃºblico", "laborando", "trabajadores", "trabajador", "funcionarios"],
    "09_CrÃ©ditos": ["creditos", "crÃ©ditos", "pensiones", "prestaciones", "prÃ©stamos", "prestamo", "hipotecario", "garantÃ­a", "prÃ©stamo", "garantia", "hipotecaria", "cuotas", "pensionados"],
    "10_Presupuesto": ["monto", "dinero", "presupuestado", "invertidos", "presupuestos", "cuenta pÃºblica", "presupuesto", "financiero", "recaudadora", "dinero destinado", "monto erogado"],
    "11_Proveedores": ["proveedor", "proveedores", "empresa", "firmados", "servicios", "facturas", "padron de proveedores", "empresas", "subasta", "concurso", "almacen", "distribuciÃ³n", "servicios"],
    "12_Transporte": ["combustibles", "mantenimiento", "vehÃ­culos", "recursos materiales", "servicios", "taller", "vehicular", "gasolina", "logotipos", "conducciÃ³n", "matrÃ­cula", "traslado", "automÃ³viles", "mÃ³vil"]
}

# ğŸ“Œ Cargar el archivo Excel
df = pd.read_excel(file_name)

# ğŸ“Œ Verificar que la columna "Respuesta" existe
if "Respuesta" not in df.columns:
    raise ValueError("âš ï¸ ERROR: La columna 'Respuesta' no existe en el archivo. Verifica que tu archivo tenga una columna llamada 'Respuesta'.")

# ğŸ“Œ FunciÃ³n para clasificar cada respuesta
def clasificar_respuesta(respuesta):
    tokens = word_tokenize(str(respuesta).lower())  # Tokeniza y convierte a minÃºsculas
    clasificacion = {cat: 0 for cat in categorias}  # Inicializar con 0 todas las categorÃ­as
    
    for palabra in tokens:
        for categoria, palabras in categorias.items():
            if palabra in palabras:
                clasificacion[categoria] = 1  # Marcar con 1 si la palabra coincide

    return pd.Series(clasificacion)

# ğŸ“Œ Aplicar clasificaciÃ³n
df[list(categorias.keys())] = df["Respuesta"].apply(clasificar_respuesta)

# ğŸ“Œ Guardar el archivo con la clasificaciÃ³n
output_file = "respuestas_categorizadas.xlsx"
df.to_excel(output_file, index=False)

# ğŸ“Œ Descargar el archivo procesado
files.download(output_file)

print("âœ… ClasificaciÃ³n completada. Descarga el archivo 'respuestas_categorizadas.xlsx'.")
